<!DOCTYPE html>
<html>
  <body>
    <h2>WebSocket Test</h2>
    <button id="myButton">Record</button>
    <script>
      const ws = new WebSocket("ws://localhost:8001/ws");
      const myButton = document.getElementById("myButton");
      myButton.addEventListener("click", () => {
        start_recording();
      });

      //event for when the connection starts
        ws.onopen = () => {
        console.log("Connected to server");
        ws.send("Hello from frontend!");
      };

       //event for when the connection ends
        ws.onclose = () => {
        console.log("Disconnected from server");
      };

//event for when backend sends a message
ws.onmessage = (event) => {
  const msg = JSON.parse(event.data);
  let functionName = msg.data.name;
  let functionArgs = msg.data.args;
  console.log(JSON.stringify(msg))
  console.log("Got a message: " + functionName + " with args " + functionArgs)

  if (msg.type === "runFunction") {
    const fn = msg.data?.name;
    console.log("Server says to run:", fn);

    // Call the function dynamically if it exists
    if (typeof window[fn] === "function") {
      window[fn](msg.data?.args ?? undefined);
    } else {
      console.warn("No such function:", fn);
    }
  }
};

// Example frontend function to be called
function write_question(question) {
  alert("Användaren frågar: " + question);
}
function send_question() {
  alert("Användaren skickar frågan till AI");
}
function change_backend(backend) {
  alert("Användaren ändrar backend till: " + backend);
}


//Sends a message to the backend to start recording
function start_recording(){
  ws.send("start_recording")
}

    </script>
  </body>
</html>
